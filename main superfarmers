#include<iostream>
#include<string>
#include <cstdlib>
#include <ctime>
using namespace std;

void mostraRegolamento() {
    cout << "\n--- REGOLAMENTO DEL GIOCO SUPERFARMERS ---" << endl;
    cout << "1. Il gioco può essere giocato da un massimo di sei giocatori." << endl;
    cout << "2. L'obiettivo è completare il tabellone raccogliendo tutti gli animali." << endl;
    cout << "3. A ogni turno si lanciano due dadi." << endl;
    cout << "4. Per ogni coppia di animali ottenuta (esclusi cavallo e mucca), si riceve un tassello dell'animale corrispondente." << endl;
    cout << "5. Se esce una volpe, si perdono tutti i conigli tranne uno." << endl;
    cout << "6. Se esce un lupo, si perdono tutti gli animali tranne conigli e cavalli, a meno che si possieda un cane (piccolo o grande)." << endl;
    cout << "7. Si possono effettuare scambi tra animali dal tanto al poco o viceversa, ma non entrambi nello stesso turno." << endl;
}

void mostraScambi() {
    cout << "\n--- SCAMBI POSSIBILI ---" << endl;
    cout << "6 conigli -> 1 pecora" << endl;
    cout << "1 maiale -> 2 pecore" << endl;
    cout << "1 mucca -> 3 maiali" << endl;
    cout << "1 cavallo -> 2 mucche" << endl;
    cout << "1 pecora -> 1 cane piccolo" << endl;
    cout << "1 mucca -> 1 cane grande" << endl;
}

void ScambioGiocatori(int a, int b){
    string nomeanimali[5]:{" conigli"," pecore"," maiali"," mucche"," cavalli"};
    char risposta;
    int tipoA,tipoB, nA,nB, check;
    cout<<"avvio scambio tra "<<giocatori[a].GetNome();
    cout<<" e "<<giocatori[b].GetNome();
    cout<<endl<<endl<<endl;
    cout<<"INVENTARIO DI "<<giocatori[a].GetNome()<<endl;
    giocatori[a].Stampainventario();
    cout<<endl<<endl<<endl<<endl;
    cout<<"INVENTARIO DI "<<giocatori[b].GetNome()<<endl;
    giocatori[b].Stampainventario();
    cout<<"cosa vuoi cedere?: scegliere opzione"<<endl;
    cout<<"1: conigli"<<endl<<"2: pecore"<<endl<<"3: maiali"<<endl<<"4: mucche"<<endl<<"5: cavallo"<<endl;
    do{
        cin>>tipoA;
        tipoA--;
        if (giocatori[a].GetAnimale(tipoA)>0){
            cout<<"possiedi "<<giocatori[a].GetAnimale(tipoA)<<nomeanimali[tipoA]<<endl;
            check=true;
        }else{
            cout<<"non ne possiedi al momento, inserire un'altra opzione"<<endl;
        }
    }while(check==false);
    check==false;
    cout<<"quanti ne vuoi cedere?"<<endl;
    do{
        cin>>nA;
        if (giocatori[a].GetAnimale(tipoA)>nA){
            check=true;
        }else{
            cout<<"non ne possiedi abbastanza, inserisci un nuovo valore"<<endl;
        }
    }while(check==false);
    check==false;
    
    cout<<"cosa vuoi chiedere a "<<giocatori[b].GetNome()<<"?: scegliere opzione"<<endl;
    cout<<"1: conigli"<<endl<<"2: pecore"<<endl<<"3: maiali"<<endl<<"4: mucche"<<endl<<"5: cavallo"<<endl;
    do{
        cin>>tipoB;
        tipoB--;
        if (giocatori[b].GetAnimale(tipoB)>0){
            cout<<"il giocatore ha "<<giocatori[a].GetAnimale(tipoA)<<nomeanimali[tipoB]<<endl;
            check=true;
        }else{
            cout<<"il giocatore non ne possiede al momento, inserire un'altra opzione"<<endl;
        }
    }while(check==false);
    check==false;
    cout<<"quanti ne vuoi chiedere?"<<endl;
    do{
        cin>>nB;
        if (giocatori[b].GetAnimale(tipoB)>nB){
            check=true;
        }else{
            cout<<"il giocatore non ne possiede abbastanza, inserisci un nuovo valore da richiedere"<<endl;
        }
    }while(check==false);
    check==false;
    cout<<giocatori[b]<<", accetti lo scambio di "<<nA<<nomeanimali[tipoA]<<" per "<<nB<<nomeanimali[tipoB]<<"? (y/n)"<<endl;
    cin>>risposta;
    if(risposta=="y"||risposta=="Y"){
        //ANIMALI CEDUTI DA A A B
        giocatori[a].AggiungiAnimale(-nA, tipoA);
        giocatori[b].AggiungiAnimale(nA, tipoA);
        //ANIMALI ACQUISITI DA A A B
        giocatori[a].AggiungiAnimale(nB, tipoB);
        giocatori[b].AggiungiAnimale(-nB, tipoB);
        cout<<"scambio effettuato! :3"<<endl;
    }else{
        cout<<"scambio annullato :["
    }
} 



int main() {
    srand(time(0));
    int risposta;
    
    cout << "Benvenuto a Superfarmers" << endl;

    do {
        cout << "Cosa desideri fare?" << endl;
        cout << "1. Iniziare una partita" << endl;
        cout << "2. Leggere il regolamento" << endl;
        cout << "3. Uscire" << endl;
        cout << "Inserisci il numero corrispondente: ";
        cin >> risposta;

        if (risposta == 1) {
            cout << "\n--- INIZIO DELLA PARTITA ---" << endl;
         
        } else if (risposta == 2) {
            mostraRegolamento();

            int mostraScambiOpzione;
            cout << "\nVuoi vedere anche i possibili scambi? (1 = Sì, 2 = No): ";
            cin >> mostraScambiOpzione;

            if (mostraScambiOpzione == 1) {
                mostraScambi();
            }
        } else if (risposta != 3) {
            cout << "Scelta non valida. Riprova." << endl;
        }

    } while (risposta != 3);
    
    //INIZIO PARTITA
    int n_players;
    string nome;
    cout<<"inserire tot giocatori"<<endl;
    cin>>n_players;
    Player *giocatori[n_players];
    cout<<"inserire nome giocatori"<<endl;
    for(int i=0; i<n_players;i++){
        cin>>nome;
        giocatori[i].SetNome(nome);
    }
    bool vittoria=false;
    int vincitore=0;
    
    char scelta;
    int turno=0;//ATTENZIONE: indica il numero del giocatore che deve giocare
    while (vittoria==false){
        cout<<"TURNO DI "<<giocatori[turno].GetNome<<endl<<endl<<endl;
        cout<<"stampa inventario..."<<endl;
        giocatori[turno].Stampainventario();
        /*
        FORSE FUNZIONE WAIT
        for (int i=0; i<100000;i++){
            scelta=0;
        }*/
        cout<<"tiro dei dadi..."<<endl;
        /*
        FORSE FUNZIONE WAIT
        for (int i=0; i<100000;i++){
            scelta=0;
        }
        */
        giocatori[turno].TiroDadi();
        giocatori[turno].Stampainventario();
        cout<<endl<<endl<<endl;
        while(scelta!='x'&&scelta!='X')
        cout<<"inserire scelta:"<<endl;
        cout<<"A. effettuare uno scambio con la Riserva"<<endl;
        cout<<"B. effettuare uno scambio con un Giocatore"<<endl;
        cout<<"X. concludere il turno"<<endl;
        cin>>scelta;
        string gioc_scelto;
        bool check=false;
        switch (scelta){
            case'a':
            case'A':
                giocatori[turno].Scambio();
            break;
            case'b':
            case'B':
                cout<<"inserire nome del giocatore "<<endl;
                do{
                    cin>>gioc_scelto;  
                    for(int i=0; i<n_players;i++){
                        if(giocatori[i].GetNome==gioc_scelto){
                            check=true;
                        }
                        if (check==false){
                            cout<<"nome non valido"<<endl;
                        }
                    }
                }while(check==false);
                
                ScambioGiocatori(turno, i);
            break;
            case 'X':
            case 'x':
                giocatori[turno].ConcludiTurno();
                cout<<"turno finito"<<endl;
            break;
        }
        for(int i=0; i<n_players;)
        if(giocatori[i].GetAnimale(0)>0 && giocatori[i].GetAnimale(1) && giocatori[i].GetAnimale(2) &&giocatori[i].GetAnimale(3) &&giocatori[i].GetAnimale(4)>0){
            vittoria=true;
            vincitore=i;
        }
        
        turno++;
        if(turno>=n_players){
            turno=0;
        }
    }
    cout<<"VINCE "<<giocatori[vincitore].GetNome()<<endl;
    
    
    cout << "Grazie per aver giocato a Superfarmers Semplificato. Arrivederci!" << endl;
    return 0;
}
